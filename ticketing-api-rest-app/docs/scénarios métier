arfaitâ€¯! On va crÃ©er un tableau complet des scÃ©narios mÃ©tier pour la plateforme de tickets, avec les cas possibles, rÃ¨gles mÃ©tiers associÃ©es, rÃ©sultats attendus et solutions alternatives. Cela servira directement de rÃ©fÃ©rence pour le dÃ©veloppement, QA, et tests automatisÃ©s.

1. CrÃ©ation dâ€™un Ã©vÃ©nement
Cas	Conditions / EntrÃ©es	RÃ¨gles mÃ©tier	RÃ©sultat attendu	Solution alternative / erreur
CrÃ©ation valide	Organisateur authentifiÃ©, titre unique, start < end, capacity â‰¥ 0	VÃ©rifie unicitÃ© titre par organisateur, dates correctes	Ã‰vÃ©nement crÃ©Ã©, id gÃ©nÃ©rÃ©	Si titre dupliquÃ© â†’ erreur Â« titre dÃ©jÃ  utilisÃ© Â»
CrÃ©ation invalide	Capacity < 0	Capacity â‰¥ 0	Refus	Afficher message : "CapacitÃ© invalide"
CrÃ©ation invalide	start_datetime â‰¥ end_datetime	Start < End	Refus	Message : "Date de dÃ©but doit Ãªtre avant date de fin"
2. CrÃ©ation / modification type de ticket
Cas	Conditions	RÃ¨gles mÃ©tier	RÃ©sultat	Alternative / erreur
Type valide	Nom unique pour Ã©vÃ©nement, usage_limit â‰¥ 1	UnicitÃ© nom, usage_limit â‰¥ 1, quota â‰¥ 0	Type crÃ©Ã©	Si nom dupliquÃ© â†’ message dâ€™erreur
Type invalide	usage_limit â‰¤ 0	usage_limit â‰¥ 1	Refus	Message : "Usage limit invalide"
Quota illimitÃ©	quota = null	AutorisÃ©	OK	Aucun
3. GÃ©nÃ©ration dâ€™un ticket
Cas	Conditions	RÃ¨gles mÃ©tier	RÃ©sultat	Alternative / erreur
Ticket valide	Event actif, type existant, code unique	Code unique, HMAC gÃ©nÃ©rÃ©, magic link token gÃ©nÃ©rÃ©, status = issued	Ticket crÃ©Ã©	Si code dupliquÃ© â†’ regÃ©nÃ©rer code
Ticket gratuit	price = 0	Status peut aller directement Ã  valid	OK	-
Ticket payÃ© en ligne	price > 0, paiement non encore effectuÃ©	Status = issued, magic_link disponible	Ticket crÃ©Ã©	-
4. Paiement dâ€™un ticket
Cas	Conditions	RÃ¨gles mÃ©tier	RÃ©sultat	Alternative / erreur
Paiement via lien	URL externe OK	Status passe Ã  paid, paid_at rempli	Ticket payÃ©	Si paiement Ã©choue â†’ status = issued
Paiement cash par caissier	Ticket gÃ©nÃ©rÃ© manuellement	Status = paid, paiement enregistrÃ©	OK	Si doublon â†’ refuser
5. Scan ticket â€“ entrÃ©e
Cas	Conditions	RÃ¨gles mÃ©tier	RÃ©sultat	Alternative / erreur
Scan valide entrÃ©e	Ticket payÃ©/valid, gate actif, capacitÃ© pas dÃ©passÃ©e	VÃ©rifie status, incrÃ©mente current_in, status â†’ in, log crÃ©Ã©	Ticket validÃ©, compteur incrÃ©mentÃ©	Si gate inactif â†’ refus, message "Gate inactive"
Ticket dÃ©jÃ  entrÃ©	status = in	Ne pas autoriser double entrÃ©e	Refus, log : already_in	Affichage : "Ticket dÃ©jÃ  utilisÃ©"
Ticket invalide	status = invalid/refunded	Refus	Refus	Message : "Ticket invalide"
CapacitÃ© dÃ©passÃ©e	current_in â‰¥ event.capacity	Refus	Refus	Message : "CapacitÃ© maximale atteinte"
6. Scan ticket â€“ sortie
Cas	Conditions	RÃ¨gles mÃ©tier	RÃ©sultat	Alternative / erreur
Sortie valide	status = in, gate actif	DÃ©crÃ©mente current_in, last_gate_out mis Ã  jour, log crÃ©Ã©	OK	-
Ticket dÃ©jÃ  sorti	status â‰  in	Refus	Log : already_out	Message : "Ticket dÃ©jÃ  sorti"
Gate inactif	gate.status â‰  active	Refus	Log : error	Message : "Gate inactive"
7. Magic link accÃ¨s ticket
Cas	Conditions	RÃ¨gles mÃ©tier	RÃ©sultat	Alternative / erreur
Lien valide	token correspond ticket	AccÃ¨s au QR code, status visible	Participant voit son ticket	Token expirÃ© ou invalide â†’ refus
Lien expirÃ©	token invalide	Refus	Message : "Lien expirÃ©"	-
8. RÃ¨gles liÃ©es au statut du ticket
Status	Conditions de transition	Actions	Restrictions
issued â†’ reserved	Paiement initiÃ©	GÃ©nÃ©rer token / QR	-
reserved â†’ paid	Paiement validÃ©	paid_at = now	-
paid â†’ in	Scan entrÃ©e valide	current_in incrÃ©mentÃ©	Ne peut pas Ãªtre dÃ©jÃ  in
in â†’ out	Scan sortie	current_in dÃ©crÃ©mentÃ©	Ne peut pas Ãªtre dÃ©jÃ  out
any â†’ invalid	ExpirÃ© ou annulÃ©	log crÃ©Ã©	Ne peut plus Ãªtre scannÃ©
any â†’ refunded	Remboursement	status = refunded	Ne peut plus Ãªtre utilisÃ©
9. ScÃ©narios particuliers / edge cases

Ticket expirÃ© : validity_to dÃ©passÃ©e â†’ status = invalid, scan refusÃ©.

CapacitÃ© dÃ©passÃ©e simultanÃ©e : utiliser transaction DB / lock Redis pour atomicitÃ©.

Ticket scannÃ© au mauvais gate : autoriser seulement les actions cohÃ©rentes (ex: entrÃ©e dans exit gate â†’ refus).

Multi-scan simultanÃ© : used_count doit Ãªtre atomique.

Ticket remboursÃ© : magic link inutilisable, QR inutilisable.

Agent tente scan hors gate assignÃ© : refus, log avec dÃ©tails.

Ticket gratuit : peut passer directement au status valid si nÃ©cessaire.

10. Solutions alternatives / recommandations
Situation	Alternative / solution
Code ticket dupliquÃ©	GÃ©nÃ©rer nouveau code automatique
Lien magique expirÃ©	RegÃ©nÃ©rer token et renvoyer au participant
Gate inactive	Rediriger vers gate actif le plus proche
Paiement Ã©chouÃ©	Status reste issued, possibilitÃ© de rÃ©essayer
Event annulÃ©	Tous les tickets â†’ invalid, notifications participants
CapacitÃ© max atteinte	Refuser entrÃ©e, log result = capacity_full

ğŸ” 4. Rate limiting par ticket

Pas plus de 1 scan_in par seconde â†’ anti spam / anti duplication.

ğŸ” 5. Alertes organisateur en temps rÃ©el

Exemples :

Trop de tentatives IN sur un ticket â€œinsideâ€.

Tentative dâ€™entrÃ©e Ã  2 portes opposÃ©es dans des temps impossibles.

Nombre anormal de scans OUT alors que lâ€™utilisateur nâ€™est pas IN.

â¡ï¸ Lâ€™alerte ne bloque pas, mais notifie les superviseurs.

âœ… Avec ce tableau, tu as tous les cas possibles, rÃ¨gles mÃ©tier associÃ©es et solutions alternatives, directement exploitable pour :

DÃ©veloppement backend / frontend

Tests unitaires et dâ€™intÃ©gration

QA / validation fonctionnelle
